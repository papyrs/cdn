import{g as a,a as t,b as e,f as r,c as o,d as i,t as c,e as d,h as u,o as f,E as p,r as h,i as w,j as y,k as b,D as k}from"./p-8a485db9.js";export{n as deleteAuth,g as getIdentity,l as initAuth,m as signIn,s as signOut}from"./p-8a485db9.js";import"./p-0adadf10.js";var $="app-deck-editor > ion-content div.deck > main > deckgo-deck",v="deckgo-studio-doc",D=[{id:"google-fonts-lora",name:"Lora",family:"'Lora', serif"},{id:"google-fonts-roboto",name:"Roboto",family:"'Roboto', sans-serif"},{id:"google-fonts-open-sans",name:"Open Sans",family:"'Open Sans', sans-serif"},{id:"google-fonts-montserrat",name:"Montserrat",family:"'Montserrat', sans-serif"},{id:"google-fonts-cabin",name:"Cabin",family:"'Cabin', sans-serif"},{id:"google-fonts-lato",name:"Lato",family:"'Lato', sans-serif"},{id:"google-fonts-muli",name:"Muli",family:"'Muli', sans-serif"},{id:"google-fonts-source-sans-pro",name:"Source Sans Pro",family:"'Source Sans Pro', sans-serif"},{id:"google-fonts-libre-baskerville",name:"Libre Baskerville",family:"'Libre Baskerville', serif"},{id:"google-fonts-oswald",name:"Oswald",family:"'Oswald', sans-serif"},{id:"google-fonts-jura",name:"Jura",family:"'Jura', sans-serif"},{id:"google-fonts-fjord-one",name:"Fjord One",family:"'Fjord One', serif"},{id:"google-fonts-josefin-slab",name:"Josefin Slab",family:"'Josefin Slab', serif"}],O=["id","hydrated","contenteditable","editable","spellcheck","highlighted","custom-loader","class","placeholder","data-gramm"],_=({node:a,deep:t=!0})=>{if(C(a))return a;if(U(a)){let e=a.cloneNode(t);j(e);let r=e.querySelectorAll(O.map((a=>`[${a}]`)).join(","));for(let a of Array.from(r))j(a);return e}return null},j=a=>{for(let t of O)a.removeAttribute(t)},C=a=>a?.nodeType===Node.TEXT_NODE||a?.nodeType===Node.COMMENT_NODE,U=a=>a?.nodeType===Node.ELEMENT_NODE,E=async({meta:a,fallbackName:t,fallbackAuthor:e,selector:r})=>{let o=[x(),F({meta:a})].filter((a=>void 0!==a)),n=P({selector:r}),i=await K(),s=(a?.title||t)?.trim();return{title:s,description:(a?.description||t)?.trim(),author:a?.author?.name||e,bio:a?.author?.bio,photo_url:a?.author?.photo_url,head_extra:o.length>0?o.join(""):void 0,attributes:n,social_image_name:encodeURI(s).toLowerCase(),social_image_value:i}},x=()=>{let a=document.querySelector($)?.style.fontFamily;if(!a)return;let t=D.find((t=>a===t.family.replace(/\'/g,"")));return t?`<link rel="stylesheet" href="${(({font:a})=>`https://fonts.googleapis.com/css?display=swap&amp;family=${a.name.replace(" ","+")}`)({font:t})}">`:void 0},F=({meta:a})=>{if(a&&a.canonical)return`<link rel="canonical" href="${a.canonical}">`},P=({selector:a})=>{let t=document.querySelector(a)?.attributes;if(t)return Array.from(t).filter((({name:a})=>!["id","hydrated","class","contenteditable"].includes(a))).reduce(((a,{name:t,value:e})=>(a[t]=e,a)),{})},A=()=>{let a=document.querySelectorAll(`${$} > *[slide_id]`),t=({slide:a,custom:t})=>{if(a.hasAttribute(`custom-${t}`))return;let e=a.querySelector(`div[slot="${t}"]`);!e||a.removeChild(e)};return Array.from(a).map((a=>{let e=_({node:a,deep:!1});return Array.from(a.childNodes).forEach((a=>{U(a)&&a.hasAttribute("slot")&&(e.appendChild(_({node:a})),t({slide:e,custom:"background"}),t({slide:e,custom:"header"}),t({slide:e,custom:"footer"}))})),e})).map((a=>a.outerHTML))},I=()=>{let a=document.querySelectorAll(`${v} > article *[paragraph_id]`);return Array.from(a).map((a=>_({node:a,deep:!0}))).map((a=>a.outerHTML))},K=async()=>document.querySelector("deckgo-social-img")?.toBlob("image/png");const S=async()=>{const r=a();if(!r)throw new Error("No internet identity to get the canisters status");const[o,n]=await Promise.all([t({identity:r}),e({identity:r})]),{actor:i,bucketId:s}=o,{actor:c,bucketId:d}=n,[l,u]=await Promise.all([i.cyclesBalance(),c.cyclesBalance()]);return{data:{bucketId:s,balance:l},storage:{bucketId:d,balance:u}}},T=async({startsWith:e,notContains:r})=>{const o=a();if(!o)return[];const{actor:n}=await t({identity:o});if(!n)return[];const i=(await n.list(u({startsWith:u(e),notContains:u(r)}))).map((([,a])=>N({data:a,identity:o})));return await Promise.all(i)},N=async({data:a,identity:t})=>{const e=await o(a.data);return{id:a.id,data:Object.assign(Object.assign({},e),{owner_id:t.getPrincipal().toText(),created_at:i(a.created_at),updated_at:i(a.updated_at)})}},L=async({key:a,actor:t,log:e})=>{if(!a)return;null==e||e({msg:`[delete][start] ${a}`});const r=performance.now(),o=t||await B();await o.del(a);const n=performance.now();null==e||e({msg:`[delete][done] ${a}`,duration:n-r})},z=({key:a,actor:t})=>new Promise((async(e,n)=>{try{const n=t||await B(),s=r(await n.get(a));if(!s)return void e(void 0);const c=await o(s.data);e({id:s.id,data:Object.assign(Object.assign({},c),{created_at:i(s.created_at),updated_at:i(s.updated_at)})})}catch(a){n(a)}})),G=({key:a,data:t,id:e,actor:r,log:o})=>new Promise((async(n,i)=>{try{null==o||o({msg:`[set][start] ${a}`});const i=performance.now(),s=r||await B(),l=new Date;await s.set(a,{id:e,data:await c(t),created_at:d(t.created_at||new Date),updated_at:d(l)});const u=performance.now();null==o||o({msg:`[set][done] ${a}`,duration:u-i}),n({id:e,data:Object.assign(Object.assign({},t),{updated_at:l})})}catch(a){i(a)}})),B=async()=>{const e=a();if(!e)throw new Error("No internet identity.");const{actor:r}=await t({identity:e});if(!r)throw new Error("No actor initialized.");return r},M=async()=>T({startsWith:"/decks/",notContains:"/slides/"}),R=async a=>L({key:`/decks/${a}`}),W=async({onNext:a})=>(document.addEventListener("deckPublished",(async({detail:t})=>await a(t)),{passive:!0}),()=>document.removeEventListener("deckPublished",(({detail:t})=>a(t)),!1)),H=async()=>T({startsWith:"/docs/",notContains:"/paragraphs/"}),J=async a=>L({key:`/docs/${a}`}),q=async({onNext:a})=>(document.addEventListener("docPublished",(async({detail:t})=>await a(t)),{passive:!0}),()=>document.removeEventListener("docPublished",(({detail:t})=>a(t)),!1)),Q=(a,t)=>z({key:`/docs/${a}/paragraphs/${t}`}),V=(a,t)=>z({key:`/decks/${a}/slides/${t}`});let X=(a=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(a));for(;a--;){let r=63&e[a];t+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return t};const Y=()=>T({startsWith:"/templates/"}),Z=a=>{const t=X();return G({key:`/templates/${t}`,id:t,data:a})},aa=a=>{const{data:t,id:e}=a;return G({key:`/templates/${e}`,id:e,data:t})},ta=async a=>{f({msg:"[update][start] user"});const t=performance.now(),{data:e,id:r}=a,o=await G({key:"/user",id:r,data:e}),n=performance.now();return f({msg:"[update][done] user",duration:n-t}),o},ea=async({data:a,filename:t,folder:e,storageActor:r,headers:o,token:n,fullPath:i,log:s})=>{s({msg:`[upload][start] ${t}`});const c=performance.now(),d=i||`/${e}/${t}`,{batchId:l}=await r.initUpload({name:t,fullPath:d,token:u(n),folder:e}),m=performance.now();s({msg:`[upload][create batch] ${t}`,duration:m-c});const f=[],g=7e5,p=new Blob([await a.arrayBuffer()]);for(let a=0;a<p.size;a+=g){const t=p.slice(a,a+g);f.push(ra({batchId:l,chunk:t,storageActor:r}))}const h=await Promise.all(f),w=performance.now();s({msg:`[upload][chunks] ${t}`,duration:w-m}),await r.commitUpload({batchId:l,chunkIds:h.map((({chunkId:a})=>a)),headers:[["Content-Type",a.type],["accept-ranges","bytes"],...o]});const y=performance.now();return s({msg:`[upload][commit batch] ${t}`,duration:y-w}),s({msg:`[upload][done] ${t}`,duration:y-c}),{fullPath:d,filename:t,token:n}},ra=async({batchId:a,chunk:t,storageActor:e})=>e.uploadChunk({batchId:a,content:[...new Uint8Array(await t.arrayBuffer())]}),oa=a=>encodeURI(a.toLowerCase().replace(/\s/g,"-")),na=async()=>{const t=a();if(!t)throw new Error("No internet identity.");const r=await e({identity:t}),{actor:o,bucketId:n}=r;if(!o)throw new Error("No actor initialized.");if(!n)throw new Error("No bucket principal defined");return r},ia=async({storageUpload:a,publishData:t})=>{const{social_image_name:e,social_image_value:r}=t;if(!r)return;const{actor:o}=a;await ea({data:r,filename:`${e}.png`,folder:"meta",storageActor:o,headers:[["Cache-Control","max-age=3600"]],log:f})},sa=({template:a,data:t})=>Object.entries(t).reduce(((a,[t,e])=>a.replaceAll(`{{DECKDECKGO_${t.toUpperCase()}}}`,e||"").replaceAll(`\x3c!-- DECKDECKGO_${t.toUpperCase()} --\x3e`,e||"")),a),ca=async({indexHTML:a,folder:t,meta:e})=>{const{html:r,publishData:o}=a,{bucketId:n,actor:i}=await na(),{filename:s,pathname:c}=da({publishData:o,meta:e,folder:t}),d=`https://${n.toText()}.raw.ic0.app`,l=`${d}${c}`;let u=r.replace("{{DECKDECKGO_URL}}",l);return u=(({html:a,data:t,bucketUrl:e})=>{const{social_image_name:r}=t;return a.replaceAll("{{DECKDECKGO_SOCIAL_IMAGE}}",`${e}/meta/${r}.png`)})({html:u,data:o,bucketUrl:d}),{storageUpload:{html:u,actor:i,filename:s,pathname:c,fullUrl:l,bucketUrl:d,folder:t},publishData:o}},da=({publishData:a,meta:t,folder:e})=>{if(null==t?void 0:t.pathname){const{pathname:a}=t;return{filename:a.replace(`/${e}/`,""),pathname:a}}const r=oa(a.title);return{filename:r,pathname:`/${e}/${r}`}},la=async({publishData:a,updateTemplateContent:t,sourceFolder:e})=>{const r=await ua(e),o=sa({template:r,data:a}),{attributes:n}=a;return{html:t({attr:n?Object.entries(n).reduce(((a,[t,e])=>`${t}="${e}"; ${a}`),"").trim():void 0,template:o})}},ua=async a=>(await fetch(`${p.getInstance().get().kitPath}/${a}/index.html`)).text(),ma=({data:a,storageUpload:t,meta:e,name:r})=>{const{pathname:o}=t,n=new Date;return Object.assign(Object.assign({},a),{meta:Object.assign(Object.assign({},e||{title:r}),{pathname:o,published:!0,published_at:n,updated_at:n})})},fa=async({filename:a,html:t,actor:e,folder:r})=>{await ea({data:new Blob([t],{type:"text/html"}),filename:a,folder:r,storageActor:e,headers:[["Cache-Control","max-age=3600"]],log:f})};const ga=async({dataId:a,storageUpload:t,publishData:e,meta:r})=>{const o=await pa(),{photo_url:n}=e,i=function(a,t){var e={};for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&t.indexOf(r)<0&&(e[r]=a[r]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(a);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(a,r[o])&&(e[r[o]]=a[r[o]])}return e}(e,["photo_url"]);let s=sa({template:o,data:i});s=ha({html:s,photo_url:n}),s=await wa({dataId:a,template:s,publishData:e,storageUpload:t,meta:r});const{actor:c}=t;await ka({html:s,actor:c})},pa=async()=>(await fetch(`${p.getInstance().get().kitPath}/index.html`)).text(),ha=({photo_url:a,html:t})=>a?t.replace("\x3c!-- DECKDECKGO_PHOTO_URL --\x3e",`<img role="presentation" alt="" loading="lazy" src="${a}" />`):t,wa=async({dataId:a,template:t,storageUpload:e,publishData:r,meta:o})=>{const n=await ba(e),i=ya({dataId:a,meta:o,publishData:r,storageUpload:e});if(!n)return t.replace(/<!-- DECKDECKGO_DATA -->/,`${i}`);const s=[...n.matchAll(/<a\x20.*?data-id=".*?"[\s\S]*?a>/gm)];if(!s||s.length<=0)return t.replace(/<!-- DECKDECKGO_DATA -->/,`${i}`);const c=s.map((a=>a[0])),d=c.findIndex((t=>t.indexOf(a)>-1));return t.replace(/<!-- DECKDECKGO_DATA -->/,d>-1?c.map(((a,t)=>t===d?i:a)).join(""):[i,...c].join(""))},ya=({dataId:a,storageUpload:t,publishData:e,meta:r})=>{var o,n;const{title:i}=e,{fullUrl:s}=t,c=null!=(null==r?void 0:r.description)&&""!==(null==r?void 0:r.description)?`<p class="description">${r.description}</p>`:"",{format:d}=new Intl.DateTimeFormat("en",{year:"numeric",month:"short",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric"});return`<a data-id="${a}" href="${s}" rel="noopener noreferrer"><article><h3>${i}</h3>${c}<p>Published: ${d(null!==(o=h(null==r?void 0:r.published_at))&&void 0!==o?o:new Date)}</p><p>Edited: ${d(null!==(n=h(null==r?void 0:r.updated_at))&&void 0!==n?n:new Date)}</p></article></a>`},ba=async({bucketUrl:a})=>{const t=await fetch(a);if(t.ok)return t.text()},ka=async({html:a,actor:t})=>{await ea({data:new Blob([a],{type:"text/html"}),filename:"index.html",folder:"resources",storageActor:t,headers:[["Cache-Control","max-age=0"]],fullPath:"/",log:f})},$a=()=>p.getInstance().get().kitPath,va=async({meta:a})=>{const{actor:t}=await na(),e=(await t.list(u("resources"))).map((({name:a})=>a)),r=await Ca(),o=r.filter((({filename:a})=>!e.includes(a)));if(!o||o.length<=0)return;const n=o.map((e=>Da({kit:e,actor:t,meta:a})));await Promise.all(n),await Oa({kitNewFiles:o,kit:r,actor:t,meta:a})},Da=async({kit:a,actor:t,meta:e})=>{const{src:r,filename:o,mimeType:n,updateContent:i,headers:s}=a,c=await ja(r),d=i?i({content:c,meta:e}):c;await _a({filename:o,content:d,actor:t,mimeType:n,headers:s,fullPath:r.replace($a(),"")})},Oa=async({kitNewFiles:a,kit:t,actor:e,meta:r})=>{if(void 0!==a.find((({filename:a})=>"service-worker.js"===a)))return;const o=t.find((({filename:a})=>"service-worker.js"===a));void 0===!o&&await Da({kit:o,actor:e,meta:r})},_a=async({filename:a,fullPath:t,content:e,actor:r,mimeType:o,headers:n})=>{await ea({data:new Blob([e],{type:o}),filename:a,folder:"resources",storageActor:r,fullPath:t,headers:n,log:f})},ja=async a=>(await fetch(a)).text(),Ca=async()=>{const a=$a(),t=await(await fetch(`${a}/build.json`)).json();return t.map((t=>(t=>{const e=`${a}/${t}`;return e.includes(".js")?{src:e,mimeType:"text/javascript"}:e.includes(".css")?{src:e,mimeType:"text/css"}:e.includes(".webmanifest")?{src:e,mimeType:"application/manifest+json",updateContent:({content:a,meta:t})=>{var e;return a.replace("{{DECKDECKGO_AUTHOR}}",(null===(e=null==t?void 0:t.author)||void 0===e?void 0:e.name)||p.getInstance().get().author)}}:{src:e,mimeType:"text/plain"}})(t))).map((a=>{const{pathname:t}=new URL(a.src);return Object.assign(Object.assign({},a),{filename:t.split("/").pop(),headers:[["Cache-Control","max-age=31536000"]]})}))},Ua=async({deck:a})=>{await va({meta:a.data.meta});const{storageUpload:t,publishData:e,deck:r}=await(async({deck:a})=>{const{id:t,data:e}=a,{meta:r}=e,o=await(async({deck:a})=>{const t=await(async({deck:a,fallbackAuthor:t})=>{let{data:e}=a,{meta:r,background:o,footer:n,header:i}=e;return{...await E({meta:r,selector:$,fallbackName:e.name,fallbackAuthor:t}),slides:A(),background:o?`<div slot="background">${o}</div>`:void 0,header:o?`<div slot="header">${i}</div>`:void 0,footer:o?`<div slot="footer">${n}</div>`:void 0}})({deck:a,fallbackAuthor:p.getInstance().get().author}),{slides:e}=t,{html:r}=await la({publishData:t,updateTemplateContent:({attr:a,template:t})=>t.replace("\x3c!-- DECKDECKGO_DECK --\x3e",`<deckgo-deck id="slider" embedded="true" ${a||""}>${e.join("")}</deckgo-deck>`),sourceFolder:"p"});return{html:r,publishData:t}})({deck:a}),{storageUpload:n,publishData:i}=await ca({indexHTML:o,folder:"p",meta:r}),s=ma({data:e,meta:e.meta,name:e.name,storageUpload:n}),c=await G({key:`/decks/${t}`,id:t,data:s});return await fa(n),await ia({storageUpload:n,publishData:i}),{storageUpload:n,publishData:i,deck:c}})({deck:a});return await ga({storageUpload:t,publishData:e,dataId:r.id,meta:a.data.meta}),(a=>{const{id:t,data:e}=a,r={id:t,data:Object.assign(Object.assign({},e),{deploy:{api:{status:"successful",updated_at:new Date}}})},o=new CustomEvent("deckPublished",{detail:r});document.dispatchEvent(o)})(r),r},Ea=async({doc:a,config:t})=>{await va({meta:a.data.meta});const{storageUpload:e,publishData:r,doc:o}=await(async({doc:a,config:t})=>{const{id:e,data:r}=a,{meta:o}=r,n=await(async({doc:a,config:t})=>{const e=await(async({doc:a,fallbackAuthor:t,theme:e})=>{let{data:r}=a,{meta:o}=r;return{...await E({meta:o,selector:v,fallbackName:r.name,fallbackAuthor:t}),paragraphs:I(),theme:e}})({doc:a,fallbackAuthor:p.getInstance().get().author,theme:t.theme}),{paragraphs:r}=e,{html:o}=await la({publishData:e,updateTemplateContent:({attr:a,template:t})=>t.replace("\x3c!-- DECKDECKGO_DOC --\x3e",`<article ${a||""} class="deckgo-doc">${r.join("")}</article>`),sourceFolder:"d"});return{html:o,publishData:e}})({doc:a,config:t}),{storageUpload:i,publishData:s}=await ca({indexHTML:n,folder:"d",meta:o}),c=ma({data:r,meta:r.meta,name:r.name,storageUpload:i}),d=await G({key:`/docs/${e}`,id:e,data:c});return await fa(i),await ia({storageUpload:i,publishData:s}),{storageUpload:i,publishData:s,doc:d}})({doc:a,config:t});return await ga({storageUpload:e,publishData:r,dataId:o.id,meta:a.data.meta}),(a=>{const{id:t,data:e}=a,r={id:t,data:Object.assign(Object.assign({},e),{deploy:{api:{status:"successful",updated_at:new Date}}})},o=new CustomEvent("docPublished",{detail:r});document.dispatchEvent(o)})(o),o},xa=async()=>{const{bucketId:a}=await na();return`https://${a.toText()}.raw.ic0.app`},Fa=async({data:t,folder:e,maxSize:r})=>{const o=a();return Pa({data:t,folder:e,maxSize:r,identity:o,log:f})},Pa=async({data:a,maxSize:t,folder:r,identity:o,storageBucket:n,log:i})=>{if(!a||!a.name)throw new Error("File not valid.");if(a.size>t)throw new Error(`File is too big (max. ${t/1048576} Mb)`);const{actor:s,bucketId:c}=n||await e({identity:o});if(!s||!c)throw new Error("Storage bucket is not initialized.");const{fullPath:d,filename:l,token:u}=await ea({data:a,filename:oa(a.name),folder:r,storageActor:s,token:X(),headers:[["cache-control","private, max-age=0"]],log:i});return{downloadUrl:`https://${c.toText()}.raw.ic0.app${d}?token=${u}`,fullPath:d,name:l}},Aa=async({folder:a})=>{const{actor:t,bucketId:e}=await na(),r=await t.list(u(a)),o=`https://${e.toText()}.raw.ic0.app`;return{items:r.map((({name:a,fullPath:t,token:e})=>({downloadUrl:`${o}${t}?token=${e}`,fullPath:t,name:a}))),nextPageToken:null}},Ia=async({downloadUrl:a,fullPath:t})=>{const{actor:e}=await na();let r=null;if(a){const{searchParams:t}=new URL(a);r=t.get("token")}return e.del({fullPath:t,token:u(r||void 0)})};function Ka(a){return new Promise((function(t,e){a.oncomplete=a.onsuccess=function(){return t(a.result)},a.onabort=a.onerror=function(){return e(a.error)}}))}var Sa;function Ta(){return Sa||(a="keyval-store",t="keyval",r=(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(a){var t=function(){return indexedDB.databases().finally(a)};e=setInterval(t,100),t()})).finally((function(){return clearInterval(e)})):Promise.resolve()).then((function(){var e=indexedDB.open(a);return e.onupgradeneeded=function(){return e.result.createObjectStore(t)},Ka(e)})),Sa=function(a,e){return r.then((function(r){return e(r.transaction(t,a).objectStore(t))}))}),Sa;var a,t,e,r}const Na=({data:a,storageFile:t,imgSrc:e})=>{const{downloadUrl:r,name:o}=t;let n=a.replaceAll(`img-src="${e}"`,`img-src="${r}"`);return n=n.replaceAll(`img-alt="${e}"`,`img-alt="${o}"`),n},La=async({selector:a,storageFile:t,src:e})=>{const r=document.querySelector(a);if("deckgo-lazy-img"===(null==r?void 0:r.nodeName.toLowerCase()))return void await za({images:[r],storageFile:t,src:e});const o=null==r?void 0:r.querySelectorAll("deckgo-lazy-img");await za({images:Array.from(o),storageFile:t,src:e})},za=async({storageFile:a,images:t,src:e})=>{const r=t.filter((a=>a.imgSrc===e));if(!r||r.length<=0)return;const o=Array.from(r).map((t=>(async t=>{const{downloadUrl:e,name:r}=a;t.imgSrc=e,t.imgAlt=r})(t)));await Promise.all(o)},Ga=async({storageFile:a,src:t,key:e})=>{const r=(({paragraph:a,images:t})=>{if(!t)return Object.assign({},a);const e=t.filter((({src:a,storageFile:t})=>void 0!==a&&void 0!==t));let{children:r,nodeName:o,attributes:n}=a.data;return"deckgo-lazy-img"===o&&n&&e.forEach((({src:a,storageFile:t})=>{n=(({attributes:a,storageFile:t,imgSrc:e})=>{const{downloadUrl:r}=t;return Object.keys(a).reduce(((t,o)=>(t[o]=a[o]===e?r:a[o],t)),{})})({attributes:n,storageFile:t,imgSrc:a})})),r=null==r?void 0:r.map((a=>(e.forEach((({src:t,storageFile:e})=>{a=Na({data:a,storageFile:e,imgSrc:t})})),a))),{id:a.id,data:Object.assign(Object.assign({},a.data),{updated_at:new Date,children:r,attributes:n})}})({paragraph:await Ba({key:e}),images:[{src:t,storageFile:a}]});await Ma({key:e,data:r})},Ba=async({key:a})=>{const t=await function(a){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ta())("readonly",(function(t){return Ka(t.get(a))}))}(a);if(!t)throw new Error("Data not found and that is really weird here.");return t},Ma=async({key:a,data:t})=>function(a,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ta())("readwrite",(function(e){return e.put(t,a),Ka(e.transaction)}))}(a,t),Ra=w(import("./p-31b26cd4.js").then((a=>a.worker)),"stencil.sync.ic.worker","uploadWorker"),Wa=async({msg:a,data:t})=>{"deckdeckgo_sync_deck_background"===a&&await(async a=>{(({storageFile:a})=>{const t=document.querySelector(`${$} > *[slot="background"]`),e=null==t?void 0:t.querySelector("deckgo-lazy-img");if(!e)return;const{downloadUrl:r,name:o}=a;e.imgSrc=r,e.imgAlt=o})(a),await(async({storageFile:a,src:t})=>{const e=document.querySelectorAll(`${$} .deckgo-slide-container:not([custom-background]) *[slot="background"] deckgo-lazy-img`);await za({images:Array.from(e),storageFile:a,src:t})})(a),await(async({storageFile:a,src:t,key:e})=>{const r=(({deck:a,storageFile:t,imgSrc:e})=>t&&e?{id:a.id,data:Object.assign(Object.assign({},a.data),{updated_at:new Date,background:Na({data:a.data.background,imgSrc:e,storageFile:t})})}:Object.assign({},a))({deck:await Ba({key:e}),imgSrc:t,storageFile:a});await Ma({key:e,data:r})})(a)})(t),"deckdeckgo_sync_slide_image"===a&&await(async a=>{const{selector:t}=a;t&&(await La(a),await(async({storageFile:a,src:t,key:e})=>{const r=(({slide:a,images:t})=>{if(!t)return Object.assign({},a);const e=t.filter((({src:a,storageFile:t})=>void 0!==a&&void 0!==t));let{content:r}=a.data;return e.forEach((({src:a,storageFile:t})=>{r=Na({data:r,storageFile:t,imgSrc:a})})),{id:a.id,data:Object.assign(Object.assign({},a.data),{updated_at:new Date,content:r})}})({slide:await Ba({key:e}),images:[{src:t,storageFile:a}]});await Ma({key:e,data:r})})(a))})(t),"deckdeckgo_sync_slide_chart"===a&&await(async a=>{const{selector:t}=a;t&&((({selector:a,storageFile:t})=>{const e=document.querySelector(a);if(!e||!e.nodeName||"deckgo-slide-chart"!==e.nodeName.toLowerCase())return;const{downloadUrl:r}=t;e.src=r})(a),await(async({storageFile:a,src:t,key:e})=>{const r=(({slide:a,chart:t})=>{if(!t)return Object.assign({},a);const{src:e,storageFile:r}=t;if(!e||!r)return Object.assign({},a);const{attributes:o}=a.data;if(!o)return Object.assign({},a);const{downloadUrl:n}=r;return{id:a.id,data:Object.assign(Object.assign({},a.data),{updated_at:new Date,attributes:Object.assign(Object.assign({},o),{src:n})})}})({slide:await Ba({key:e}),chart:{src:t,storageFile:a}});await Ma({key:e,data:r})})(a))})(t),"deckdeckgo_sync_paragraph_image"===a&&await(async a=>{const{selector:t}=a;t&&(await La(a),await Ga(a))})(t)},Ha=async({syncData:t,clean:e})=>{if(!a())throw new Error("No internet identity to sync data");const r=await y();if(!b(k.fromJSON(r.delegationChain)))throw new Error("Internet identity has expired. Please login again.");await Ra({internetIdentity:r,syncData:t,env:p.getInstance().get()},Wa,f),await e(t)};export{S as canistersBalance,Z as createTemplate,M as deckEntries,Ua as deckPublish,R as deleteDeck,J as deleteDoc,Ia as deleteFile,H as docEntries,Ea as docPublish,Aa as getFiles,Q as getParagraph,V as getSlide,Y as getUserTemplates,xa as publishUrl,W as snapshotDeck,q as snapshotDoc,Ha as sync,aa as updateTemplate,ta as updateUser,Fa as uploadFile,Pa as uploadFileIC}