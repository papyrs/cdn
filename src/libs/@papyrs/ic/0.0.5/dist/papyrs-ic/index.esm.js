import{g as a,a as t,b as e,f as o,c as r,d as i,t as c,e as d,h as u,o as f,E as p,i as h,j as w,k as y,D as b}from"./p-2a66ad04.js";export{n as deleteAuth,g as getIdentity,l as initAuth,m as signIn,s as signOut}from"./p-2a66ad04.js";import"./p-0adadf10.js";var k="app-deck-editor > ion-content div.deck > main > deckgo-deck",$="deckgo-studio-doc",v=[{id:"google-fonts-lora",name:"Lora",family:"'Lora', serif"},{id:"google-fonts-roboto",name:"Roboto",family:"'Roboto', sans-serif"},{id:"google-fonts-open-sans",name:"Open Sans",family:"'Open Sans', sans-serif"},{id:"google-fonts-montserrat",name:"Montserrat",family:"'Montserrat', sans-serif"},{id:"google-fonts-cabin",name:"Cabin",family:"'Cabin', sans-serif"},{id:"google-fonts-lato",name:"Lato",family:"'Lato', sans-serif"},{id:"google-fonts-muli",name:"Muli",family:"'Muli', sans-serif"},{id:"google-fonts-source-sans-pro",name:"Source Sans Pro",family:"'Source Sans Pro', sans-serif"},{id:"google-fonts-libre-baskerville",name:"Libre Baskerville",family:"'Libre Baskerville', serif"},{id:"google-fonts-oswald",name:"Oswald",family:"'Oswald', sans-serif"},{id:"google-fonts-jura",name:"Jura",family:"'Jura', sans-serif"},{id:"google-fonts-fjord-one",name:"Fjord One",family:"'Fjord One', serif"},{id:"google-fonts-josefin-slab",name:"Josefin Slab",family:"'Josefin Slab', serif"}],D=["id","hydrated","contenteditable","editable","spellcheck","highlighted","custom-loader","class","placeholder","data-gramm"],O=({node:a,deep:t=!0})=>{if(j(a))return a;if(C(a)){let e=a.cloneNode(t);_(e);let o=e.querySelectorAll(D.map((a=>`[${a}]`)).join(","));for(let a of Array.from(o))_(a);return e}return null},_=a=>{for(let t of D)a.removeAttribute(t)},j=a=>a?.nodeType===Node.TEXT_NODE||a?.nodeType===Node.COMMENT_NODE,C=a=>a?.nodeType===Node.ELEMENT_NODE,U=async({meta:a,fallbackName:t,fallbackAuthor:e,selector:o})=>{let r=[x(),E({meta:a})].filter((a=>void 0!==a)),n=F({selector:o}),i=await I(),s=(a?.title||t)?.trim();return{title:s,description:(a?.description||t)?.trim(),author:a?.author?.name||e,bio:a?.author?.bio,photo_url:a?.author?.photo_url,head_extra:r.length>0?r.join(""):void 0,attributes:n,social_image_name:encodeURI(s).toLowerCase(),social_image_value:i}},x=()=>{let a=document.querySelector(k)?.style.fontFamily;if(!a)return;let t=v.find((t=>a===t.family.replace(/\'/g,"")));return t?`<link rel="stylesheet" href="${(({font:a})=>`https://fonts.googleapis.com/css?display=swap&amp;family=${a.name.replace(" ","+")}`)({font:t})}">`:void 0},E=({meta:a})=>{if(a&&a.canonical)return`<link rel="canonical" href="${a.canonical}">`},F=({selector:a})=>{let t=document.querySelector(a)?.attributes;if(t)return Array.from(t).filter((({name:a})=>!["id","hydrated","class","contenteditable"].includes(a))).reduce(((a,{name:t,value:e})=>(a[t]=e,a)),{})},A=()=>{let a=document.querySelectorAll(`${k} > *[slide_id]`),t=({slide:a,custom:t})=>{if(a.hasAttribute(`custom-${t}`))return;let e=a.querySelector(`div[slot="${t}"]`);!e||a.removeChild(e)};return Array.from(a).map((a=>{let e=O({node:a,deep:!1});return Array.from(a.childNodes).forEach((a=>{C(a)&&a.hasAttribute("slot")&&(e.appendChild(O({node:a})),t({slide:e,custom:"background"}),t({slide:e,custom:"header"}),t({slide:e,custom:"footer"}))})),e})).map((a=>a.outerHTML))},P=()=>{let a=document.querySelectorAll(`${$} > article *[paragraph_id]`);return Array.from(a).map((a=>O({node:a,deep:!0}))).map((a=>a.outerHTML))},I=async()=>document.querySelector("deckgo-social-img")?.toBlob("image/png");const K=async()=>{const o=a();if(!o)throw new Error("No internet identity to get the canisters status");const[r,n]=await Promise.all([t({identity:o}),e({identity:o})]),{actor:i,bucketId:s}=r,{actor:c,bucketId:d}=n,[l,u]=await Promise.all([i.cyclesBalance(),c.cyclesBalance()]);return{data:{bucketId:s,balance:l},storage:{bucketId:d,balance:u}}},S=async({startsWith:e,notContains:o})=>{const r=a();if(!r)return[];const{actor:n}=await t({identity:r});if(!n)return[];const i=(await n.list(u({startsWith:u(e),notContains:u(o)}))).map((([,a])=>T({data:a,identity:r})));return await Promise.all(i)},T=async({data:a,identity:t})=>{const e=await r(a.data);return{id:a.id,data:Object.assign(Object.assign({},e),{owner_id:t.getPrincipal().toText(),created_at:i(a.created_at),updated_at:i(a.updated_at)})}},N=async({key:a,actor:t,log:e})=>{if(!a)return;null==e||e({msg:`[delete][start] ${a}`});const o=performance.now(),r=t||await G();await r.del(a);const n=performance.now();null==e||e({msg:`[delete][done] ${a}`,duration:n-o})},L=({key:a,actor:t})=>new Promise((async(e,n)=>{try{const n=t||await G(),s=o(await n.get(a));if(!s)return void e(void 0);const c=await r(s.data);e({id:s.id,data:Object.assign(Object.assign({},c),{created_at:i(s.created_at),updated_at:i(s.updated_at)})})}catch(a){n(a)}})),z=({key:a,data:t,id:e,actor:o,log:r})=>new Promise((async(n,i)=>{try{null==r||r({msg:`[set][start] ${a}`});const i=performance.now(),s=o||await G(),l=new Date;await s.set(a,{id:e,data:await c(t),created_at:d(t.created_at||new Date),updated_at:d(l)});const u=performance.now();null==r||r({msg:`[set][done] ${a}`,duration:u-i}),n({id:e,data:Object.assign(Object.assign({},t),{updated_at:l})})}catch(a){i(a)}})),G=async()=>{const e=a();if(!e)throw new Error("No internet identity.");const{actor:o}=await t({identity:e});if(!o)throw new Error("No actor initialized.");return o},B=async()=>S({startsWith:"/decks/",notContains:"/slides/"}),M=async a=>N({key:`/decks/${a}`}),R=async({onNext:a})=>(document.addEventListener("deckPublished",(async({detail:t})=>await a(t)),{passive:!0}),()=>document.removeEventListener("deckPublished",(({detail:t})=>a(t)),!1)),W=async()=>S({startsWith:"/docs/",notContains:"/paragraphs/"}),H=async a=>N({key:`/docs/${a}`}),J=async({onNext:a})=>(document.addEventListener("docPublished",(async({detail:t})=>await a(t)),{passive:!0}),()=>document.removeEventListener("docPublished",(({detail:t})=>a(t)),!1)),q=(a,t)=>L({key:`/docs/${a}/paragraphs/${t}`}),Q=(a,t)=>L({key:`/decks/${a}/slides/${t}`});let V=(a=21)=>{let t="",e=crypto.getRandomValues(new Uint8Array(a));for(;a--;){let o=63&e[a];t+=o<36?o.toString(36):o<62?(o-26).toString(36).toUpperCase():o<63?"_":"-"}return t};const X=()=>S({startsWith:"/templates/"}),Y=a=>{const t=V();return z({key:`/templates/${t}`,id:t,data:a})},Z=a=>{const{data:t,id:e}=a;return z({key:`/templates/${e}`,id:e,data:t})},aa=async a=>{f({msg:"[update][start] user"});const t=performance.now(),{data:e,id:o}=a,r=await z({key:"/user",id:o,data:e}),n=performance.now();return f({msg:"[update][done] user",duration:n-t}),r},ta=async({data:a,filename:t,folder:e,storageActor:o,headers:r,token:n,fullPath:i,log:s})=>{s({msg:`[upload][start] ${t}`});const c=performance.now(),d=i||`/${e}/${t}`,{batchId:l}=await o.initUpload({name:t,fullPath:d,token:u(n),folder:e}),m=performance.now();s({msg:`[upload][create batch] ${t}`,duration:m-c});const f=[],g=7e5,p=new Blob([await a.arrayBuffer()]);for(let a=0;a<p.size;a+=g){const t=p.slice(a,a+g);f.push(ea({batchId:l,chunk:t,storageActor:o}))}const h=await Promise.all(f),w=performance.now();s({msg:`[upload][chunks] ${t}`,duration:w-m}),await o.commitUpload({batchId:l,chunkIds:h.map((({chunkId:a})=>a)),headers:[["Content-Type",a.type],["accept-ranges","bytes"],...r]});const y=performance.now();return s({msg:`[upload][commit batch] ${t}`,duration:y-w}),s({msg:`[upload][done] ${t}`,duration:y-c}),{fullPath:d,filename:t,token:n}},ea=async({batchId:a,chunk:t,storageActor:e})=>e.uploadChunk({batchId:a,content:[...new Uint8Array(await t.arrayBuffer())]}),oa=a=>encodeURI(a.toLowerCase().replace(/\s/g,"-")),ra=async()=>{const t=a();if(!t)throw new Error("No internet identity.");const o=await e({identity:t}),{actor:r,bucketId:n}=o;if(!r)throw new Error("No actor initialized.");if(!n)throw new Error("No bucket principal defined");return o},na=async({storageUpload:a,publishData:t})=>{const{social_image_name:e,social_image_value:o}=t;if(!o)return;const{actor:r}=a;await ta({data:o,filename:`${e}.png`,folder:"meta",storageActor:r,headers:[["Cache-Control","max-age=3600"]],log:f})},ia=({template:a,data:t})=>Object.entries(t).reduce(((a,[t,e])=>a.replaceAll(`{{DECKDECKGO_${t.toUpperCase()}}}`,e||"").replaceAll(`\x3c!-- DECKDECKGO_${t.toUpperCase()} --\x3e`,e||"")),a),sa=async({indexHTML:a,folder:t,meta:e})=>{const{html:o,publishData:r}=a,{bucketId:n,actor:i}=await ra(),{filename:s,pathname:c}=ca({publishData:r,meta:e,folder:t}),d=`https://${n.toText()}.raw.ic0.app`,l=`${d}${c}`;let u=o.replace("{{DECKDECKGO_URL}}",l);return u=(({html:a,data:t,bucketUrl:e})=>{const{social_image_name:o}=t;return a.replaceAll("{{DECKDECKGO_SOCIAL_IMAGE}}",`${e}/meta/${o}.png`)})({html:u,data:r,bucketUrl:d}),{storageUpload:{html:u,actor:i,filename:s,pathname:c,fullUrl:l,bucketUrl:d,folder:t},publishData:r}},ca=({publishData:a,meta:t,folder:e})=>{if(null==t?void 0:t.pathname){const{pathname:a}=t;return{filename:a.replace(`/${e}/`,""),pathname:a}}const o=oa(a.title);return{filename:o,pathname:`/${e}/${o}`}},da=async({publishData:a,updateTemplateContent:t,sourceFolder:e})=>{const o=await la(e),r=ia({template:o,data:a}),{attributes:n}=a;return{html:t({attr:n?Object.entries(n).reduce(((a,[t,e])=>`${t}="${e}"; ${a}`),"").trim():void 0,template:r})}},la=async a=>(await fetch(`${p.getInstance().get().kitPath}/${a}/index.html`)).text(),ua=({data:a,storageUpload:t,meta:e,name:o})=>{const{pathname:r}=t,n=new Date;return Object.assign(Object.assign({},a),{meta:Object.assign(Object.assign({},e||{title:o}),{pathname:r,published:!0,published_at:n,updated_at:n})})},ma=async({filename:a,html:t,actor:e,folder:o})=>{await ta({data:new Blob([t],{type:"text/html"}),filename:a,folder:o,storageActor:e,headers:[["Cache-Control","max-age=3600"]],log:f})};const fa=async({dataId:a,storageUpload:t,publishData:e})=>{const o=await ga(),{photo_url:r}=e,n=function(a,t){var e={};for(var o in a)Object.prototype.hasOwnProperty.call(a,o)&&t.indexOf(o)<0&&(e[o]=a[o]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(a);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(a,o[r])&&(e[o[r]]=a[o[r]])}return e}(e,["photo_url"]);let i=ia({template:o,data:n});i=pa({html:i,photo_url:r}),i=await ha({dataId:a,template:i,publishData:e,storageUpload:t});const{actor:s}=t;await ya({html:i,actor:s})},ga=async()=>(await fetch(`${p.getInstance().get().kitPath}/index.html`)).text(),pa=({photo_url:a,html:t})=>a?t.replace("\x3c!-- DECKDECKGO_PHOTO_URL --\x3e",`<img role="presentation" alt="" loading="lazy" src="${a}" />`):t,ha=async({dataId:a,template:t,storageUpload:e,publishData:o})=>{const{title:r}=o,{fullUrl:n}=e,i=`<li data-id="${a}"><a href="${n}">${r}</a></li>`,s=await wa(e);if(!s)return t.replace(/<!-- DECKDECKGO_DATA -->/,`${i}`);const c=[...s.matchAll(/<li\x20.*?data-id=".*?".*?li>/gm)];if(!c||c.length<=0)return t.replace(/<!-- DECKDECKGO_DATA -->/,`${i}`);const d=c.map((a=>a[0])),l=d.indexOf(i);return t.replace(/<!-- DECKDECKGO_DATA -->/,l>-1?d.map(((a,t)=>t===l?i:a)).join(""):[i,...d].join(""))},wa=async({bucketUrl:a})=>{const t=await fetch(a);if(t.ok)return t.text()},ya=async({html:a,actor:t})=>{await ta({data:new Blob([a],{type:"text/html"}),filename:"index.html",folder:"resources",storageActor:t,headers:[["Cache-Control","max-age=0"]],fullPath:"/",log:f})},ba=()=>p.getInstance().get().kitPath,ka=async({meta:a})=>{const{actor:t}=await ra(),e=(await t.list(u("resources"))).map((({name:a})=>a)),o=await _a(),r=o.filter((({filename:a})=>!e.includes(a)));if(!r||r.length<=0)return;const n=r.map((e=>$a({kit:e,actor:t,meta:a})));await Promise.all(n),await va({kitNewFiles:r,kit:o,actor:t,meta:a})},$a=async({kit:a,actor:t,meta:e})=>{const{src:o,filename:r,mimeType:n,updateContent:i,headers:s}=a,c=await Oa(o),d=i?i({content:c,meta:e}):c;await Da({filename:r,content:d,actor:t,mimeType:n,headers:s,fullPath:o.replace(ba(),"")})},va=async({kitNewFiles:a,kit:t,actor:e,meta:o})=>{if(void 0!==a.find((({filename:a})=>"service-worker.js"===a)))return;const r=t.find((({filename:a})=>"service-worker.js"===a));void 0===!r&&await $a({kit:r,actor:e,meta:o})},Da=async({filename:a,fullPath:t,content:e,actor:o,mimeType:r,headers:n})=>{await ta({data:new Blob([e],{type:r}),filename:a,folder:"resources",storageActor:o,fullPath:t,headers:n,log:f})},Oa=async a=>(await fetch(a)).text(),_a=async()=>{const a=ba(),t=await(await fetch(`${a}/build.json`)).json();return t.map((t=>(t=>{const e=`${a}/${t}`;return e.includes(".js")?{src:e,mimeType:"text/javascript"}:e.includes(".css")?{src:e,mimeType:"text/css"}:e.includes(".webmanifest")?{src:e,mimeType:"application/manifest+json",updateContent:({content:a,meta:t})=>{var e;return a.replace("{{DECKDECKGO_AUTHOR}}",(null===(e=null==t?void 0:t.author)||void 0===e?void 0:e.name)||p.getInstance().get().author)}}:{src:e,mimeType:"text/plain"}})(t))).map((a=>{const{pathname:t}=new URL(a.src);return Object.assign(Object.assign({},a),{filename:t.split("/").pop(),headers:[["Cache-Control","max-age=31536000"]]})}))},ja=async({deck:a})=>{await ka({meta:a.data.meta});const{storageUpload:t,publishData:e,deck:o}=await(async({deck:a})=>{const{id:t,data:e}=a,{meta:o}=e,r=await(async({deck:a})=>{const t=await(async({deck:a,fallbackAuthor:t})=>{let{data:e}=a,{meta:o,background:r,footer:n,header:i}=e;return{...await U({meta:o,selector:k,fallbackName:e.name,fallbackAuthor:t}),slides:A(),background:r?`<div slot="background">${r}</div>`:void 0,header:r?`<div slot="header">${i}</div>`:void 0,footer:r?`<div slot="footer">${n}</div>`:void 0}})({deck:a,fallbackAuthor:p.getInstance().get().author}),{slides:e}=t,{html:o}=await da({publishData:t,updateTemplateContent:({attr:a,template:t})=>t.replace("\x3c!-- DECKDECKGO_DECK --\x3e",`<deckgo-deck id="slider" embedded="true" ${a||""}>${e.join("")}</deckgo-deck>`),sourceFolder:"p"});return{html:o,publishData:t}})({deck:a}),{storageUpload:n,publishData:i}=await sa({indexHTML:r,folder:"p",meta:o}),s=ua({data:e,meta:e.meta,name:e.name,storageUpload:n}),c=await z({key:`/decks/${t}`,id:t,data:s});return await ma(n),await na({storageUpload:n,publishData:i}),{storageUpload:n,publishData:i,deck:c}})({deck:a});return await fa({storageUpload:t,publishData:e,dataId:o.id}),(a=>{const{id:t,data:e}=a,o={id:t,data:Object.assign(Object.assign({},e),{deploy:{api:{status:"successful",updated_at:new Date}}})},r=new CustomEvent("deckPublished",{detail:o});document.dispatchEvent(r)})(o),o},Ca=async({doc:a,config:t})=>{await ka({meta:a.data.meta});const{storageUpload:e,publishData:o,doc:r}=await(async({doc:a,config:t})=>{const{id:e,data:o}=a,{meta:r}=o,n=await(async({doc:a,config:t})=>{const e=await(async({doc:a,fallbackAuthor:t,theme:e})=>{let{data:o}=a,{meta:r}=o;return{...await U({meta:r,selector:$,fallbackName:o.name,fallbackAuthor:t}),paragraphs:P(),theme:e}})({doc:a,fallbackAuthor:p.getInstance().get().author,theme:t.theme}),{paragraphs:o}=e,{html:r}=await da({publishData:e,updateTemplateContent:({attr:a,template:t})=>t.replace("\x3c!-- DECKDECKGO_DOC --\x3e",`<article ${a||""} class="deckgo-doc">${o.join("")}</article>`),sourceFolder:"d"});return{html:r,publishData:e}})({doc:a,config:t}),{storageUpload:i,publishData:s}=await sa({indexHTML:n,folder:"d",meta:r}),c=ua({data:o,meta:o.meta,name:o.name,storageUpload:i}),d=await z({key:`/docs/${e}`,id:e,data:c});return await ma(i),await na({storageUpload:i,publishData:s}),{storageUpload:i,publishData:s,doc:d}})({doc:a,config:t});return await fa({storageUpload:e,publishData:o,dataId:r.id}),(a=>{const{id:t,data:e}=a,o={id:t,data:Object.assign(Object.assign({},e),{deploy:{api:{status:"successful",updated_at:new Date}}})},r=new CustomEvent("docPublished",{detail:o});document.dispatchEvent(r)})(r),r},Ua=async()=>{const{bucketId:a}=await ra();return`https://${a.toText()}.raw.ic0.app`},xa=async({data:t,folder:e,maxSize:o})=>{const r=a();return Ea({data:t,folder:e,maxSize:o,identity:r,log:f})},Ea=async({data:a,maxSize:t,folder:o,identity:r,storageBucket:n,log:i})=>{if(!a||!a.name)throw new Error("File not valid.");if(a.size>t)throw new Error(`File is too big (max. ${t/1048576} Mb)`);const{actor:s,bucketId:c}=n||await e({identity:r});if(!s||!c)throw new Error("Storage bucket is not initialized.");const{fullPath:d,filename:l,token:u}=await ta({data:a,filename:oa(a.name),folder:o,storageActor:s,token:V(),headers:[["cache-control","private, max-age=0"]],log:i});return{downloadUrl:`https://${c.toText()}.raw.ic0.app${d}?token=${u}`,fullPath:d,name:l}},Fa=async({folder:a})=>{const{actor:t,bucketId:e}=await ra(),o=await t.list(u(a)),r=`https://${e.toText()}.raw.ic0.app`;return{items:o.map((({name:a,fullPath:t,token:e})=>({downloadUrl:`${r}${t}?token=${e}`,fullPath:t,name:a}))),nextPageToken:null}},Aa=async({downloadUrl:a,fullPath:t})=>{const{actor:e}=await ra();let o=null;if(a){const{searchParams:t}=new URL(a);o=t.get("token")}return e.del({fullPath:t,token:u(o||void 0)})};function Pa(a){return new Promise((function(t,e){a.oncomplete=a.onsuccess=function(){return t(a.result)},a.onabort=a.onerror=function(){return e(a.error)}}))}var Ia;function Ka(){return Ia||(a="keyval-store",t="keyval",o=(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise((function(a){var t=function(){return indexedDB.databases().finally(a)};e=setInterval(t,100),t()})).finally((function(){return clearInterval(e)})):Promise.resolve()).then((function(){var e=indexedDB.open(a);return e.onupgradeneeded=function(){return e.result.createObjectStore(t)},Pa(e)})),Ia=function(a,e){return o.then((function(o){return e(o.transaction(t,a).objectStore(t))}))}),Ia;var a,t,e,o}const Sa=({data:a,storageFile:t,imgSrc:e})=>{const{downloadUrl:o,name:r}=t;let n=a.replaceAll(`img-src="${e}"`,`img-src="${o}"`);return n=n.replaceAll(`img-alt="${e}"`,`img-alt="${r}"`),n},Ta=async({selector:a,storageFile:t,src:e})=>{const o=document.querySelector(a);if("deckgo-lazy-img"===(null==o?void 0:o.nodeName.toLowerCase()))return void await Na({images:[o],storageFile:t,src:e});const r=null==o?void 0:o.querySelectorAll("deckgo-lazy-img");await Na({images:Array.from(r),storageFile:t,src:e})},Na=async({storageFile:a,images:t,src:e})=>{const o=t.filter((a=>a.imgSrc===e));if(!o||o.length<=0)return;const r=Array.from(o).map((t=>(async t=>{const{downloadUrl:e,name:o}=a;t.imgSrc=e,t.imgAlt=o})(t)));await Promise.all(r)},La=async({storageFile:a,src:t,key:e})=>{const o=(({paragraph:a,images:t})=>{if(!t)return Object.assign({},a);const e=t.filter((({src:a,storageFile:t})=>void 0!==a&&void 0!==t));let{children:o,nodeName:r,attributes:n}=a.data;return"deckgo-lazy-img"===r&&n&&e.forEach((({src:a,storageFile:t})=>{n=(({attributes:a,storageFile:t,imgSrc:e})=>{const{downloadUrl:o}=t;return Object.keys(a).reduce(((t,r)=>(t[r]=a[r]===e?o:a[r],t)),{})})({attributes:n,storageFile:t,imgSrc:a})})),o=null==o?void 0:o.map((a=>(e.forEach((({src:t,storageFile:e})=>{a=Sa({data:a,storageFile:e,imgSrc:t})})),a))),{id:a.id,data:Object.assign(Object.assign({},a.data),{updated_at:new Date,children:o,attributes:n})}})({paragraph:await za({key:e}),images:[{src:t,storageFile:a}]});await Ga({key:e,data:o})},za=async({key:a})=>{const t=await function(a){return(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ka())("readonly",(function(t){return Pa(t.get(a))}))}(a);if(!t)throw new Error("Data not found and that is really weird here.");return t},Ga=async({key:a,data:t})=>function(a,t){return(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ka())("readwrite",(function(e){return e.put(t,a),Pa(e.transaction)}))}(a,t),Ba=h(import("./p-aa86695b.js").then((a=>a.worker)),"stencil.sync.ic.worker","uploadWorker"),Ma=async({msg:a,data:t})=>{"deckdeckgo_sync_deck_background"===a&&await(async a=>{(({storageFile:a})=>{const t=document.querySelector(`${k} > *[slot="background"]`),e=null==t?void 0:t.querySelector("deckgo-lazy-img");if(!e)return;const{downloadUrl:o,name:r}=a;e.imgSrc=o,e.imgAlt=r})(a),await(async({storageFile:a,src:t})=>{const e=document.querySelectorAll(`${k} .deckgo-slide-container:not([custom-background]) *[slot="background"] deckgo-lazy-img`);await Na({images:Array.from(e),storageFile:a,src:t})})(a),await(async({storageFile:a,src:t,key:e})=>{const o=(({deck:a,storageFile:t,imgSrc:e})=>t&&e?{id:a.id,data:Object.assign(Object.assign({},a.data),{updated_at:new Date,background:Sa({data:a.data.background,imgSrc:e,storageFile:t})})}:Object.assign({},a))({deck:await za({key:e}),imgSrc:t,storageFile:a});await Ga({key:e,data:o})})(a)})(t),"deckdeckgo_sync_slide_image"===a&&await(async a=>{const{selector:t}=a;t&&(await Ta(a),await(async({storageFile:a,src:t,key:e})=>{const o=(({slide:a,images:t})=>{if(!t)return Object.assign({},a);const e=t.filter((({src:a,storageFile:t})=>void 0!==a&&void 0!==t));let{content:o}=a.data;return e.forEach((({src:a,storageFile:t})=>{o=Sa({data:o,storageFile:t,imgSrc:a})})),{id:a.id,data:Object.assign(Object.assign({},a.data),{updated_at:new Date,content:o})}})({slide:await za({key:e}),images:[{src:t,storageFile:a}]});await Ga({key:e,data:o})})(a))})(t),"deckdeckgo_sync_slide_chart"===a&&await(async a=>{const{selector:t}=a;t&&((({selector:a,storageFile:t})=>{const e=document.querySelector(a);if(!e||!e.nodeName||"deckgo-slide-chart"!==e.nodeName.toLowerCase())return;const{downloadUrl:o}=t;e.src=o})(a),await(async({storageFile:a,src:t,key:e})=>{const o=(({slide:a,chart:t})=>{if(!t)return Object.assign({},a);const{src:e,storageFile:o}=t;if(!e||!o)return Object.assign({},a);const{attributes:r}=a.data;if(!r)return Object.assign({},a);const{downloadUrl:n}=o;return{id:a.id,data:Object.assign(Object.assign({},a.data),{updated_at:new Date,attributes:Object.assign(Object.assign({},r),{src:n})})}})({slide:await za({key:e}),chart:{src:t,storageFile:a}});await Ga({key:e,data:o})})(a))})(t),"deckdeckgo_sync_paragraph_image"===a&&await(async a=>{const{selector:t}=a;t&&(await Ta(a),await La(a))})(t)},Ra=async({syncData:t,clean:e})=>{if(!a())throw new Error("No internet identity to sync data");const o=await w();if(!y(b.fromJSON(o.delegationChain)))throw new Error("Internet identity has expired. Please login again.");await Ba({internetIdentity:o,syncData:t,env:p.getInstance().get()},Ma,f),await e(t)};export{K as canistersBalance,Y as createTemplate,B as deckEntries,ja as deckPublish,M as deleteDeck,H as deleteDoc,Aa as deleteFile,W as docEntries,Ca as docPublish,Fa as getFiles,q as getParagraph,Q as getSlide,X as getUserTemplates,Ua as publishUrl,R as snapshotDeck,J as snapshotDoc,Ra as sync,Z as updateTemplate,aa as updateUser,xa as uploadFile,Ea as uploadFileIC}