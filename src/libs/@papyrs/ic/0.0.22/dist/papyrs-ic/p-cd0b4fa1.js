import{E as e,e as t,h as a}from"./p-c5cbdeda.js";import{A as s,d as i}from"./p-0df7b987.js";import{c as n}from"./p-ee0b2015.js";var o=e=>{let t=new CustomEvent("ddgLog",{detail:e,bubbles:!0});document.dispatchEvent(t)};const r=(e,t)=>{const a=globalThis[t];return null!=a&&e instanceof a},c=e=>{if(null!=e){if(r(e,"ArrayBuffer")||r(e,"MessagePort")||r(e,"ImageBitmap")||r(e,"OffscreenCanvas"))return[e];if("object"==typeof e)return e.constructor===Object&&(e=Object.values(e)),Array.isArray(e)?e.flatMap(c):c(e.buffer)}return[]};let l=0,u=0;const d=new Map,w=new Map,m=(e,t,a)=>{const s=new Worker(e,{name:t});return s.addEventListener("message",(({data:e})=>{if(e){const t=e[0],s=e[1],i=e[2];if(t===a){const t=e[3],[a,o,r]=d.get(s);if(d.delete(s),t){const e=t.isError?Object.assign(new Error(t.value.message),t.value):t.value;n(e),o(e)}else r&&r.forEach((e=>w.delete(e))),a(i)}else if(t===a+".cb")try{w.get(s)(...i)}catch(e){n(e)}}})),s},f=(e,t,a)=>(...s)=>new Promise(((i,n)=>{let o=l++,r=0,m=s.length,f=[i,n];for(d.set(o,f);r<m;r++)if("function"==typeof s[r]){const e=u++;w.set(e,s[r]),s[r]=[t+".cb",e],(f[2]=f[2]||[]).push(e)}const b=e=>e.postMessage([t,o,a,s],c(s));e.then?e.then(b):b(e)})),b=import("./p-48a87607.js").then((e=>e.worker)),p=f(b,"stencil.idle.ic.worker","startIdleTime"),y=f(b,"stencil.idle.ic.worker","stopIdleTimer"),v=f(import("./p-807d44ae.js").then((e=>e.worker)),"stencil.user.ic.worker","initUserWorker");let h;const g=()=>s.create({idleOptions:{disableIdle:!0,disableDefaultIdleCallback:!0}}),j=async({config:t,success:a})=>{e.getInstance().set(t),h=await g(),await(null==h?void 0:h.isAuthenticated())&&(await E({success:a}),await v({env:e.getInstance().get()},(async e=>await O({user:e,success:a})),o),await p((()=>{const e=new CustomEvent("ddgSignOut",{bubbles:!0});document.dispatchEvent(e)})))},E=async({success:e})=>{await e({authUser:{state:"initialization"},user:void 0})},O=async({user:e,success:t})=>{const{id:a,data:s}=e,{name:i,email:n,photo_url:o}=s,r={uid:a,state:"authenticated",name:i,email:n,photo_url:o};await t({authUser:r,user:e})},k=async()=>{await y(),await(null==h?void 0:h.logout()),h=void 0,await i("/user")},I=async({onSuccess:a,onError:s})=>{h=h||await g(),await h.login(Object.assign({onSuccess:a,onError:s,maxTimeToLive:t},e.getInstance().localIdentity()&&{identityProvider:`http://${e.getInstance().get().localIdentityCanisterId}.localhost:8000?#authorize`}))},T=async()=>{const e=C();if(!e)throw new Error("Invalid identity.");const t=await a({identity:e});await Promise.all([t.delData(),t.delStorage()])},C=()=>null==h?void 0:h.getIdentity(),P=()=>null==h?void 0:h.isAuthenticated();export{j as a,I as b,f as c,T as d,m as e,C as g,P as i,k as s,o as t}